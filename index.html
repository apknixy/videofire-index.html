<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Fire</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google IMA SDK for VAST Ads -->
    <script src="https://imasdk.googleapis.com/js/sdkloader/ima3.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif; /* Inter font ka upyog */
            background-color: #0d0d0d; /* Gehra background color */
            margin: 0;
            padding: 0;
            overflow: hidden; /* Body scroll ko rokna, mukhy content scroll hoga */
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera ke liye */
        }
        .hide-scrollbar {
            -ms-overflow-style: none;  /* IE aur Edge ke liye */
            scrollbar-width: none;  /* Firefox ke liye */
        }
        .snap-mandatory {
            scroll-snap-type: y mandatory;
        }
        .snap-center {
            scroll-snap-align: center;
        }
        /* Ad message ke liye custom animation */
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateY(-20px); }
            10% { opacity: 1; transform: translateY(0); }
            90% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-20px); }
        }
        .animate-fade-in-out {
            animation: fadeInOut 3s ease-in-out forwards;
        }
        /* Poori screen ad container */
        #ima-ad-container {
            width: 100vw;
            height: 100vh;
            position: absolute;
            top: 0;
            left: 0;
            background-color: black;
            z-index: 100; /* Baaki sabke upar rakhna */
            display: none; /* Default roop se chupa hua */
            align-items: center;
            justify-content: center;
        }
        /* Iframe responsiveness ke liye Tailwind classes */
        iframe {
            max-width: 100%;
            height: auto;
        }
    </style>
</head>
<body class="bg-gray-950 text-white min-h-screen flex flex-col">

    <!-- Global Ad Container for IMA SDK (default roop se chupa hua) -->
    <div id="ima-ad-container" class="bg-black flex flex-col items-center justify-center">
        <div class="text-white text-lg font-bold mb-4 flex items-center">
            <svg class="animate-pulse h-6 w-6 mr-2 text-orange-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path></svg>
            <span>Ad chal raha hai...</span>
        </div>
        <svg class="animate-spin h-8 w-8 text-orange-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
        </svg>
    </div>

    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 bg-gray-900 bg-opacity-90 backdrop-blur-sm p-4 flex items-center justify-between shadow-lg z-50 rounded-b-xl border-b border-gray-800">
        <div class="flex items-center space-x-3">
            <img src="https://placehold.co/40x40/FF7F50/FFFFFF?text=VF" alt="Video Fire Logo" class="rounded-full" />
            <span class="text-2xl font-extrabold text-orange-500 drop-shadow-md">Video Fire</span>
        </div>
        <div class="flex items-center space-x-4">
            <button id="search-button" class="p-2 rounded-full hover:bg-gray-700 text-gray-300 transition duration-200" title="Khojen">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            </button>
            <button id="upload-header-button" class="p-2 rounded-full bg-orange-600 hover:bg-orange-700 text-white transition duration-200 shadow-md" title="Video Upload Karein">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
            </button>
            <button id="withdraw-header-button" class="p-2 rounded-full bg-green-600 hover:bg-green-700 text-white transition duration-200 shadow-md" title="Nikalein">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z" /></svg>
            </button>
            <button id="profile-header-button" class="p-2 rounded-full hover:bg-gray-700 text-gray-300 transition duration-200" title="Profile">
                <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
            </button>
            <div id="user-info" class="flex items-center space-x-2 text-sm text-gray-400 hidden">
                <span id="display-user-id"></span>
                <button id="sign-out-button" class="p-1 rounded-md text-xs bg-red-600 hover:bg-red-700 text-white">Sign Out</button>
            </div>
        </div>
    </header>

    <!-- Main Content Area -->
    <main class="flex-1 mt-[70px] mb-[60px] flex justify-center items-center">
        <!-- Home Page (Video Feed) -->
        <div id="home-page" class="w-full h-full overflow-y-scroll snap-y snap-mandatory bg-gray-950 hide-scrollbar">
            <div id="video-feed-container" class="w-full h-full">
                <!-- Videos yahaan inject kiye jayenge -->
            </div>
            <div id="home-loading" class="flex flex-col items-center justify-center h-full text-white hidden">
                <svg class="animate-spin h-10 w-10 text-orange-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
                <span class="ml-3 mt-2">Videos load ho rahe hain...</span>
            </div>
            <div id="home-error" class="flex items-center justify-center h-full text-red-500 text-center p-4 hidden"></div>
            <div id="no-videos-message" class="flex items-center justify-center h-full text-white text-lg hidden">
                Koi video available nahi hai. Kuch upload karein!
            </div>
        </div>

        <!-- Profile Page -->
        <div id="profile-page" class="hidden p-6 bg-gray-950 min-h-full w-full overflow-y-auto hide-scrollbar">
            <div class="max-w-4xl mx-auto">
                <div class="flex flex-col sm:flex-row items-center space-y-4 sm:space-y-0 sm:space-x-6 mb-8 bg-gray-900 p-6 rounded-xl shadow-lg border border-gray-800">
                    <img id="profile-avatar" src="https://placehold.co/100x100/374151/E5E7EB?text=U" alt="Profile Avatar" class="w-24 h-24 rounded-full border-4 border-orange-500 shadow-md" />
                    <div>
                        <h1 id="profile-username" class="text-3xl font-extrabold text-orange-400 mb-1"></h1>
                        <p class="text-gray-400">User ID: <span id="profile-user-id"></span></p>
                        <p class="text-gray-300 mt-2">Total Uploads: <span id="profile-uploads-count">0</span></p>
                    </div>
                </div>

                <h2 class="text-2xl font-bold mb-6 text-orange-300">Mere Uploads</h2>
                <div id="user-videos-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- User videos yahaan inject kiye jayenge -->
                </div>
                <p id="no-user-videos-message" class="text-gray-400 text-center py-8 bg-gray-900 rounded-lg border border-gray-800 hidden">
                    Aapne abhi tak koi video upload nahi kiya hai.
                </p>
                <div id="profile-loading" class="flex justify-center items-center h-48 text-white hidden">Profile load ho raha hai...</div>
                <div id="profile-error" class="text-red-500 text-center mt-8 hidden"></div>
            </div>
        </div>

        <!-- Search Page (Placeholder) -->
        <div id="search-page" class="hidden flex items-center justify-center h-full w-full bg-gray-950 text-white text-3xl font-bold">
            Search Functionality Jald Hi Aaegi!
        </div>
        <!-- People Page (Placeholder) -->
        <div id="people-page" class="hidden flex items-center justify-center h-full w-full bg-gray-950 text-white text-3xl font-bold">
            Log / Follow Functionality Jald Hi Aaegi!
        </div>

    </main>

    <!-- Footer -->
    <footer class="fixed bottom-0 left-0 right-0 bg-gray-900 bg-opacity-90 backdrop-blur-sm p-3 flex items-center justify-around shadow-lg z-50 rounded-t-xl border-t border-gray-800">
        <button id="home-footer-button" class="flex flex-col items-center p-2 rounded-lg transition duration-200 text-orange-500 bg-gray-800">
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m0 0l-7 7-7-7M19 10v10a1 1 0 01-1 1h-3"></path></svg>
            <span class="text-xs mt-1">Home</span>
        </button>
        <button id="people-footer-button" class="flex flex-col items-center p-2 rounded-lg transition duration-200 text-gray-400 hover:bg-gray-700">
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M17 20h2a2 2 0 002-2V4a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2h2m0 0a2 2 0 100 4 2 2 0 000-4zm0 0H9m4 0h4m-4 0a2 2 0 100 4 2 2 0 000-4zm0 0H9"></path></svg>
            <span class="text-xs mt-1">Log</span>
        </button>
        <button id="upload-footer-button" class="flex flex-col items-center p-2 rounded-lg transition duration-200 text-gray-400 hover:bg-gray-700">
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
            <span class="text-xs mt-1">Upload</span>
        </button>
        <button id="profile-footer-button" class="flex flex-col items-center p-2 rounded-lg transition duration-200 text-gray-400 hover:bg-gray-700">
            <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
            <span class="text-xs mt-1">Profile</span>
        </button>
    </footer>

    <!-- Custom Modal Structure -->
    <div id="custom-modal" class="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-[1000] p-4 hidden">
        <div class="bg-gray-800 p-6 rounded-lg shadow-xl border border-gray-700 max-w-sm w-full text-white text-center">
            <h3 id="custom-modal-title" class="text-xl font-bold mb-4 text-orange-400"></h3>
            <p id="custom-modal-message" class="mb-6 text-gray-300"></p>
            <div class="flex justify-center space-x-4">
                <button id="custom-modal-confirm-button" class="px-6 py-2 bg-green-600 hover:bg-green-700 rounded-md font-semibold transition duration-200 hidden">Pushti Karein</button>
                <button id="custom-modal-close-button" class="px-6 py-2 bg-red-600 hover:bg-red-700 rounded-md font-semibold transition duration-200">Band Karein</button>
            </div>
        </div>
    </div>

    <!-- Comment Modal Structure -->
    <div id="comment-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-end justify-center z-[900] p-0 hidden">
        <div class="bg-gray-800 w-full max-w-lg h-3/4 rounded-t-2xl shadow-lg flex flex-col overflow-hidden">
            <div class="flex justify-between items-center p-4 border-b border-gray-700 bg-gray-900">
                <h2 class="text-xl font-bold text-orange-400">Comments</h2>
                <button id="comment-modal-close-button" class="p-2 rounded-full hover:bg-gray-700 text-gray-300">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div id="comment-list" class="flex-1 overflow-y-auto p-4 hide-scrollbar">
                <div id="comment-loading" class="flex flex-col justify-center items-center h-full text-white hidden">
                    <svg class="animate-spin h-6 w-6 text-orange-400" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span class="ml-2 mt-2 text-gray-300">Comments load ho rahe hain...</span>
                </div>
                <p id="no-comments-message" class="text-gray-400 text-center mt-4 hidden">Abhi tak koi comment nahi. Pehle comment karein!</p>
                <!-- Comments yahaan inject kiye jayenge -->
            </div>
            <div class="p-4 border-t border-gray-700 bg-gray-900">
                <div class="flex space-x-2">
                    <input type="text" id="new-comment-input" class="flex-1 p-3 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500 border border-gray-600" placeholder="Ek comment likhein..." />
                    <button id="add-comment-button" class="px-5 py-3 bg-orange-600 hover:bg-orange-700 rounded-lg font-semibold text-white transition duration-200">Post Karein</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Video Modal Structure -->
    <div id="upload-video-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[900] p-4 hidden">
        <div class="bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-md border border-gray-700">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-orange-400">Naya Video Upload Karein</h2>
                <button id="upload-modal-close-button" class="p-2 rounded-full hover:bg-gray-700 text-gray-300">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <form id="upload-video-form">
                <div class="mb-4">
                    <label for="video-url-input" class="block text-gray-300 text-sm font-semibold mb-2">YouTube Video URL:</label>
                    <input type="text" id="video-url-input" class="w-full p-3 bg-gray-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 border border-gray-600" placeholder="e.g., https://youtu.be/WC2FUEmKEu8" required />
                </div>
                <div class="mb-6">
                    <label for="video-title-input" class="block text-gray-300 text-sm font-semibold mb-2">Video Title:</label>
                    <input type="text" id="video-title-input" class="w-full p-3 bg-gray-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 border border-gray-600" placeholder="Video ka title enter karein" required />
                </div>
                <p id="upload-error-message" class="text-red-500 text-sm mb-4 hidden"></p>
                <button type="submit" id="upload-submit-button" class="w-full py-3 bg-orange-600 hover:bg-orange-700 text-white font-bold rounded-md transition duration-200 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <span id="upload-button-text">Video Upload Karein</span>
                    <svg id="upload-loading-spinner" class="animate-spin h-5 w-5 ml-3 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </form>
        </div>
    </div>

    <!-- Withdraw Modal Structure -->
    <div id="withdraw-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[900] p-4 hidden">
        <div class="bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-md border border-gray-700">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-orange-400">Earnings Nikalein</h2>
                <button id="withdraw-modal-close-button" class="p-2 rounded-full hover:bg-gray-700 text-gray-300">
                    <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <p class="text-gray-300 text-sm mb-4">
                Minimum nikasi rashi: ₹100. Payments UPI ke madhyam se manually bheje jate hain.
            </p>
            <form id="withdraw-form">
                <div class="mb-4">
                    <label for="withdraw-amount-input" class="block text-gray-300 text-sm font-semibold mb-2">Rashi (₹):</label>
                    <input type="number" id="withdraw-amount-input" class="w-full p-3 bg-gray-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 border border-gray-600" placeholder="e.g., 150" min="100" step="any" required />
                </div>
                <div class="mb-6">
                    <label for="upi-id-input" class="block text-gray-300 text-sm font-semibold mb-2">Aapki UPI ID:</label>
                    <input type="text" id="upi-id-input" class="w-full p-3 bg-gray-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 border border-gray-600" placeholder="e.g., aapkanam@upi" required />
                </div>
                <p id="withdraw-error-message" class="text-red-500 text-sm mb-4 hidden"></p>
                <button type="submit" id="withdraw-submit-button" class="w-full py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-md transition duration-200 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <span id="withdraw-button-text">Nikasi Ka Anurodh Karein</span>
                    <svg id="withdraw-loading-spinner" class="animate-spin h-5 w-5 ml-3 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </form>
        </div>
    </div>

    <!-- Authentication Modal Structure -->
    <div id="auth-modal" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-[1100] p-4 hidden">
        <div class="bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-md border border-gray-700 text-center">
            <h2 id="auth-modal-title" class="text-2xl font-bold text-orange-400 mb-6">Login / Sign Up</h2>

            <div class="flex justify-center mb-6">
                <button id="auth-tab-login" class="px-6 py-3 rounded-l-lg font-semibold transition duration-200" style="background-color: #f97316; color: white;">Login</button>
                <button id="auth-tab-signup" class="px-6 py-3 rounded-r-lg font-semibold bg-gray-700 text-gray-300 hover:bg-gray-600 transition duration-200">Sign Up</button>
            </div>

            <!-- Login Form -->
            <form id="login-form" class="space-y-4">
                <input type="email" id="login-email" class="w-full p-3 bg-gray-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 border border-gray-600" placeholder="Email" required />
                <input type="password" id="login-password" class="w-full p-3 bg-gray-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 border border-gray-600" placeholder="Password" required />
                <p id="login-error-message" class="text-red-500 text-sm hidden"></p>
                <button type="submit" id="login-submit-button" class="w-full py-3 bg-orange-600 hover:bg-orange-700 text-white font-bold rounded-md transition duration-200 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <span id="login-button-text">Login</span>
                    <svg id="login-loading-spinner" class="animate-spin h-5 w-5 ml-3 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
                <button type="button" id="forgot-password-button" class="text-gray-400 hover:text-orange-400 text-sm mt-2">Password Bhool Gaye?</button>
            </form>

            <!-- Sign Up Form -->
            <form id="signup-form" class="space-y-4 hidden">
                <input type="email" id="signup-email" class="w-full p-3 bg-gray-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 border border-gray-600" placeholder="Email" required />
                <input type="password" id="signup-password" class="w-full p-3 bg-gray-700 text-white rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500 border border-gray-600" placeholder="Password (kam se kam 6 akshar)" required />
                <p id="signup-error-message" class="text-red-500 text-sm hidden"></p>
                <button type="submit" id="signup-submit-button" class="w-full py-3 bg-orange-600 hover:bg-orange-700 text-white font-bold rounded-md transition duration-200 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed">
                    <span id="signup-button-text">Sign Up Karein</span>
                    <svg id="signup-loading-spinner" class="animate-spin h-5 w-5 ml-3 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                </button>
            </form>

            <div class="relative flex items-center justify-center my-6">
                <div class="absolute inset-0 flex items-center">
                    <div class="w-full border-t border-gray-700"></div>
                </div>
                <div class="relative z-10 px-4 bg-gray-800 text-gray-400 text-sm">YA</div>
            </div>

            <button id="google-sign-in-button" class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-md transition duration-200 flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed">
                <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12.0001 4.54518C14.1561 4.54518 15.9321 5.26718 17.2791 6.55418L20.0241 3.80918C18.1081 1.86818 15.2891 0.72718 12.0001 0.72718C7.68313 0.72718 4.02013 3.03718 2.05413 6.44418L6.08213 9.47918C6.96713 7.21818 9.38713 5.45418 12.0001 5.45418V4.54518ZM23.0901 12.0002C23.0901 11.2332 23.0231 10.4792 22.8981 9.73918H12.0001V14.2612H18.4141C18.1751 15.6362 17.3871 16.7902 16.2051 17.5842L20.2331 20.6192C22.2001 17.1852 23.0901 13.9162 23.0901 12.0002Z" fill="#4285F4"/>
                    <path d="M12.0001 23.2732C15.2891 23.2732 18.1081 22.1322 20.0241 20.1912L17.2791 17.4462C15.9321 18.7332 14.1561 19.4552 12.0001 19.4552C9.38713 19.4552 6.96713 17.6912 6.08213 15.4302L2.05413 18.4652C4.02013 21.8722 7.68313 23.2732 12.0001 23.2732Z" fill="#34A853"/>
                    <path d="M4.05404 15.4302L0.0259998 18.4652C0.603003 19.4202 1.34304 20.2792 2.22804 20.9702L6.25604 17.9352C5.37104 17.2442 4.63104 16.3852 4.05404 15.4302Z" fill="#F9BC05"/>
                    <path d="M2.05404 6.44418L6.08204 9.47918C6.96704 7.21818 9.38704 5.45418 12.0001 5.45418V0.72718C7.68313 0.72718 4.02013 3.03718 2.05404 6.44418Z" fill="#EA4335"/>
                </svg>
                <span>Google ke saath Sign In karein</span>
            </button>

            <button id="guest-login-button" class="w-full py-3 bg-gray-700 hover:bg-gray-600 text-white font-bold rounded-md transition duration-200 mt-4 disabled:opacity-50 disabled:cursor-not-allowed">
                <span id="guest-login-button-text">Guest ke roop mein jaari rakhein</span>
                <svg id="guest-login-loading-spinner" class="animate-spin h-5 w-5 ml-3 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </button>
        </div>
    </div>


    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import {
            getAuth,
            signInAnonymously,
            signInWithCustomToken,
            onAuthStateChanged,
            signOut,
            createUserWithEmailAndPassword,
            signInWithEmailAndPassword,
            sendPasswordResetEmail,
            sendEmailVerification,
            GoogleAuthProvider,
            signInWithPopup
        } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, addDoc, setDoc, updateDoc, deleteDoc, onSnapshot, collection, query, where, getDocs, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- Global Variables ---
        let app;
        let db;
        let auth;
        let currentUserId = null;
        let authReady = false; // Flag to indicate if Firebase auth is initialized
        let currentPage = 'home'; // 'home', 'profile', 'search', 'people'
        let currentVideoIdForComments = null;

        // Firebase Configuration (from provided data)
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "AIzaSyDes3ioeygnWBqJB6NnHb7xj732JJhOqm8",
            authDomain: "videofire-268ff.firebaseapp.com",
            databaseURL: "https://videofire-268ff-default-rtdb.firebaseio.com",
            projectId: "videofire-268ff",
            storageBucket: "videofire-268ff.firebasestorage.app",
            messagingSenderId: "910374058927",
            appId: "1:910374058927:web:6add3afdea07cfa2914d5a"
        };
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        // VAST Ad Tag URL
        const vastAdTagUrl = "https://assured-sandwich.com/dsm/Fzz.daGsN/vNZUGoUR/oeRmF9OufZFUylok/PkTDYe0zM/jfQp0zOlTvYDt/NIjTQyyGNQDsQr5tNoycZQseaKWo1lpFdWDU0ix-";

        // --- DOM Elements ---
        const homePage = document.getElementById('home-page');
        const profilePage = document.getElementById('profile-page');
        const searchPage = document.getElementById('search-page');
        const peoplePage = document.getElementById('people-page');
        const videoFeedContainer = document.getElementById('video-feed-container');

        const homeLoading = document.getElementById('home-loading');
        const homeError = document.getElementById('home-error');
        const noVideosMessage = document.getElementById('no-videos-message');

        const profileUsername = document.getElementById('profile-username');
        const profileUserId = document.getElementById('profile-user-id');
        const profileUploadsCount = document.getElementById('profile-uploads-count');
        const userVideosContainer = document.getElementById('user-videos-container');
        const noUserVideosMessage = document.getElementById('no-user-videos-message');
        const profileLoading = document.getElementById('profile-loading');
        const profileError = document.getElementById('profile-error');

        const customModal = document.getElementById('custom-modal');
        const customModalTitle = document.getElementById('custom-modal-title');
        const customModalMessage = document.getElementById('custom-modal-message');
        const customModalConfirmButton = document.getElementById('custom-modal-confirm-button');
        const customModalCloseButton = document.getElementById('custom-modal-close-button');

        const commentModal = document.getElementById('comment-modal');
        const commentModalCloseButton = document.getElementById('comment-modal-close-button');
        const commentList = document.getElementById('comment-list');
        const commentLoading = document.getElementById('comment-loading');
        const noCommentsMessage = document.getElementById('no-comments-message');
        const newCommentInput = document.getElementById('new-comment-input');
        const addCommentButton = document.getElementById('add-comment-button');

        const uploadVideoModal = document.getElementById('upload-video-modal');
        const uploadModalCloseButton = document.getElementById('upload-modal-close-button');
        const uploadVideoForm = document.getElementById('upload-video-form');
        const videoUrlInput = document.getElementById('video-url-input');
        const videoTitleInput = document.getElementById('video-title-input');
        const uploadErrorMessage = document.getElementById('upload-error-message');
        const uploadSubmitButton = document.getElementById('upload-submit-button');
        const uploadButtonText = document.getElementById('upload-button-text');
        const uploadLoadingSpinner = document.getElementById('upload-loading-spinner');

        const withdrawModal = document.getElementById('withdraw-modal');
        const withdrawModalCloseButton = document.getElementById('withdraw-modal-close-button');
        const withdrawForm = document.getElementById('withdraw-form');
        const withdrawAmountInput = document.getElementById('withdraw-amount-input');
        const upiIdInput = document.getElementById('upi-id-input');
        const withdrawErrorMessage = document.getElementById('withdraw-error-message');
        const withdrawSubmitButton = document.getElementById('withdraw-submit-button');
        const withdrawButtonText = document.getElementById('withdraw-button-text');
        const withdrawLoadingSpinner = document.getElementById('withdraw-loading-spinner');

        const imaAdContainer = document.getElementById('ima-ad-container'); // Global IMA ad container

        const displayUserId = document.getElementById('display-user-id');
        const userInfo = document.getElementById('user-info');
        const signOutButton = document.getElementById('sign-out-button');

        // Auth Modal Elements
        const authModal = document.getElementById('auth-modal');
        const authTabLogin = document.getElementById('auth-tab-login');
        const authTabSignup = document.getElementById('auth-tab-signup');

        const loginForm = document.getElementById('login-form');
        const loginEmailInput = document.getElementById('login-email');
        const loginPasswordInput = document.getElementById('login-password');
        const loginErrorMessage = document.getElementById('login-error-message');
        const loginSubmitButton = document.getElementById('login-submit-button');
        const loginButtonText = document.getElementById('login-button-text');
        const loginLoadingSpinner = document.getElementById('login-loading-spinner');
        const forgotPasswordButton = document.getElementById('forgot-password-button');

        const signupForm = document.getElementById('signup-form');
        const signupEmailInput = document.getElementById('signup-email');
        const signupPasswordInput = document.getElementById('signup-password');
        const signupErrorMessage = document.getElementById('signup-error-message');
        const signupSubmitButton = document.getElementById('signup-submit-button');
        const signupButtonText = document.getElementById('signup-button-text');
        const signupLoadingSpinner = document.getElementById('signup-loading-spinner');

        const googleSignInButton = document.getElementById('google-sign-in-button');
        const guestLoginButton = document.getElementById('guest-login-button');
        const guestLoginButtonText = document.getElementById('guest-login-button-text');
        const guestLoginLoadingSpinner = document.getElementById('guest-login-loading-spinner');


        // --- Utility Functions ---

        /**
         * YouTube URL ko parse karta hai video ID, embed URL, aur thumbnail URL nikalne ke liye.
         * @param {string} url - YouTube video URL.
         * @returns {object|null} videoId, embedUrl, thumbnailUrl ke saath ek object, ya agar invalid hai toh null.
         */
        function getYouTubeInfo(url) {
            const regExp = /(?:https?:\/\/)?(?:www\.)?(?:m\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=|embed\/|shorts\/|v\/|)([\w-]{11})(?:\S+)?/g;
            const match = regExp.exec(url);

            if (match && match[1]) {
                const videoId = match[1];
                return {
                    videoId: videoId,
                    embedUrl: `https://www.youtube.com/embed/${videoId}?autoplay=1&controls=0&modestbranding=1&rel=0&loop=1&playlist=${videoId}`, // Autoplay, no controls, loop
                    thumbnailUrl: `https://img.youtube.com/vi/${videoId}/hqdefault.jpg`
                };
            }
            return null;
        }

        /**
         * Custom modal dialog dikhata hai.
         * @param {string} title - Modal ka title.
         * @param {string} message - Message content.
         * @param {boolean} showConfirmButton - Confirm button dikhana hai ya nahi.
         * @param {function} onConfirm - Confirm button ke liye callback.
         * @param {function} onClose - Close button ke liye callback.
         */
        function showCustomModal(title, message, showConfirmButton = false, onConfirm = () => {}, onClose = () => {}) {
            customModalTitle.textContent = title;
            customModalMessage.textContent = message;
            customModalConfirmButton.onclick = () => { onConfirm(); closeModal('custom'); };
            customModalCloseButton.onclick = () => { onClose(); closeModal('custom'); };

            if (showConfirmButton) {
                customModalConfirmButton.classList.remove('hidden');
            } else {
                customModalConfirmButton.classList.add('hidden');
            }
            customModal.classList.remove('hidden');
        }

        /**
         * Ek specific modal ko band karta hai.
         * @param {string} modalName - Modal ka naam ('custom', 'comment', 'upload', 'withdraw', 'auth').
         */
        function closeModal(modalName) {
            switch (modalName) {
                case 'custom':
                    customModal.classList.add('hidden');
                    break;
                case 'comment':
                    commentModal.classList.add('hidden');
                    currentVideoIdForComments = null;
                    break;
                case 'upload':
                    uploadVideoModal.classList.add('hidden');
                    uploadVideoForm.reset(); // Form clear karein
                    videoUrlInput.value = ''; // Inputs ko puri tarah reset karein
                    videoTitleInput.value = '';
                    uploadErrorMessage.classList.add('hidden');
                    break;
                case 'withdraw':
                    withdrawModal.classList.add('hidden');
                    withdrawForm.reset();
                    withdrawAmountInput.value = '';
                    upiIdInput.value = '';
                    withdrawErrorMessage.classList.add('hidden');
                    break;
                case 'auth':
                    authModal.classList.add('hidden');
                    loginForm.reset();
                    signupForm.reset();
                    loginErrorMessage.classList.add('hidden');
                    signupErrorMessage.classList.add('hidden');
                    break;
            }
        }


        // --- Firebase Initialization ---

        /**
         * Firebase ko initialize karta hai aur authentication listener set karta hai.
         */
        async function initializeFirebase() {
            console.log("Firebase initialize ho raha hai...");
            try {
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                console.log("Firebase app, db, auth initialize ho gaye hain.");

                // Auth state listener
                onAuthStateChanged(auth, async (user) => {
                    console.log("Auth state badal gaya. User:", user ? user.uid : "Koi user nahi");
                    if (user) {
                        currentUserId = user.uid;
                        displayUserId.textContent = user.email ? user.email.split('@')[0] : currentUserId.substring(0, 8) + '...';
                        userInfo.classList.remove('hidden'); // User ki jaankari dikhayein
                        closeModal('auth'); // Agar user login ho gaya hai toh auth modal band karein

                        // Sunischit karein ki user profile maujood hai (ya ek dummy banayein)
                        const userProfileRef = doc(db, `artifacts/${appId}/users/${user.uid}/profile/${user.uid}`);
                        try {
                            const userDoc = await getDoc(userProfileRef);
                            if (!userDoc.exists()) {
                                console.log("Nayi user profile bana rahe hain UID ke liye:", user.uid);
                                await setDoc(userProfileRef, {
                                    username: user.email ? user.email.split('@')[0] : `User_${user.uid.substring(0, 6)}`,
                                    email: user.email || null,
                                    joinedAt: serverTimestamp(),
                                    isEmailVerified: user.emailVerified || false,
                                });
                            } else {
                                // Latest jaankari ke saath profile update karein agar email verified hai
                                const userData = userDoc.data();
                                if (user.emailVerified && !userData.isEmailVerified) {
                                    await updateDoc(userProfileRef, { isEmailVerified: true });
                                }
                            }
                        } catch (profileError) {
                            console.error("User profile banane/fetch karne mein error:", profileError);
                            showCustomModal('Profile Error', 'User profile load karne mein asafal. Kuch features seemit ho sakte hain.', false);
                        }

                    } else {
                        currentUserId = null;
                        displayUserId.textContent = '';
                        userInfo.classList.add('hidden'); // User ki jaankari chhupayein
                        authModal.classList.remove('hidden'); // Auth modal dikhayein agar koi user login nahi hai
                    }
                    authReady = true; // Firebase auth ne apni shuruaati jaanch poori kar li hai
                    console.log("Auth taiyar hai. Vartaman page:", currentPage);
                    // Page tabhi dikhayein jab auth taiyar ho aur user login ho (ya explicitly guest ho)
                    if (user || initialAuthToken) { // Agar user login hai ya custom token try kiya gaya tha
                        showPage(currentPage);
                    } else if (!user && !authModal.classList.contains('hidden')) {
                         // Agar koi user nahi aur auth modal dikh raha hai, toh kuch na karein (user action ka intezaar karein)
                         homeLoading.classList.add('hidden'); // Loading chhupayein agar auth modal dikh raha hai
                    }
                });

                // Agar initialAuthToken available hai toh uska upyog karein
                if (initialAuthToken) {
                    try {
                        console.log("Custom token se sign in kar rahe hain...");
                        await signInWithCustomToken(auth, initialAuthToken);
                        console.log("Custom token se sign in safaltaapoorvak ho gaya.");
                    } catch (error) {
                        console.error("Custom token se sign in karne mein error:", error);
                        // showCustomModal('Authentication Error', 'Pradan kiye gaye token se sign in karne mein asafal. Kripya manual login try karein.', false);
                        // onAuthStateChanged listener is asafal prayas ke baad koi user na hone ki sthiti ko handle karega.
                    }
                }

                console.log("Firebase initialize ho gaya.");

            } catch (error) {
                console.error("Critical: Firebase initialize karne mein asafal:", error);
                showCustomModal('Initialization Error', 'Application initialize karne mein asafal. Kripya console mein details check karein aur sunischit karein ki aapka Firebase config sahi hai.', false);
                authReady = false;
                // Poori screen par error message dikhayein
                homeLoading.classList.add('hidden');
                homeError.textContent = `Application initialize karne mein gambhir error: ${error.message}. Kripya apni Firebase configuration check karein.`;
                homeError.classList.remove('hidden');
                homePage.classList.remove('hidden'); // Sunischit karein ki home page error dikhane ke liye dikh raha hai
                profilePage.classList.add('hidden'); // Baaki pages chhupayein
            }
        }


        // --- UI Navigation aur Rendering ---

        /**
         * Nirdisht page dikhata hai aur dusron ko chhupata hai.
         * @param {string} pageName - Dikhane wale page ka naam ('home', 'profile', 'search', 'people').
         */
        function showPage(pageName) {
            currentPage = pageName;
            const pages = [homePage, profilePage, searchPage, peoplePage];
            const footerButtons = {
                'home': document.getElementById('home-footer-button'),
                'people': document.getElementById('people-footer-button'),
                'upload': document.getElementById('upload-footer-button'), // Dhyaan dein: Upload ek modal hai, lekin button yahaan hai
                'profile': document.getElementById('profile-footer-button')
            };

            pages.forEach(page => page.classList.add('hidden'));

            Object.values(footerButtons).forEach(btn => {
                if(btn) btn.classList.remove('text-orange-500', 'bg-gray-800');
                if(btn) btn.classList.add('text-gray-400', 'hover:bg-gray-700');
            });

            if (!authReady || !currentUserId) {
                console.log("Auth taiyar nahi ya user login nahi hai, auth modal dikha rahe hain.");
                authModal.classList.remove('hidden');
                homeLoading.classList.add('hidden');
                return;
            }

            switch (pageName) {
                case 'home':
                    homePage.classList.remove('hidden');
                    footerButtons['home'].classList.add('text-orange-500', 'bg-gray-800');
                    footerButtons['home'].classList.remove('text-gray-400', 'hover:bg-gray-700');
                    updateVideoFeed(); // Home dikhane par videos load karein
                    break;
                case 'profile':
                    profilePage.classList.remove('hidden');
                    footerButtons['profile'].classList.add('text-orange-500', 'bg-gray-800');
                    footerButtons['profile'].classList.remove('text-gray-400', 'hover:bg-gray-700');
                    updateProfilePage(); // Profile dikhane par profile data load karein
                    break;
                case 'search':
                    searchPage.classList.remove('hidden');
                    break;
                case 'people':
                    peoplePage.classList.remove('hidden');
                    footerButtons['people'].classList.add('text-orange-500', 'bg-gray-800');
                    footerButtons['people'].classList.remove('text-gray-400', 'hover:bg-gray-700');
                    break;
                default:
                    homePage.classList.remove('hidden'); // Home par fallback
                    footerButtons['home'].classList.add('text-orange-500', 'bg-gray-800');
                    footerButtons['home'].classList.remove('text-gray-400', 'hover:bg-gray-700');
                    updateVideoFeed();
                    break;
            }
        }

        /**
         * Home page par video feed ko update karta hai.
         */
        async function updateVideoFeed() {
            if (!authReady || !db) {
                console.warn("Firebase video feed ke liye taiyar nahi. updateVideoFeed ko rok rahe hain.");
                homeLoading.classList.add('hidden');
                homeError.textContent = "App taiyar nahi. Kripya intezaar karein ya refresh karein.";
                homeError.classList.remove('hidden');
                return;
            }

            homeLoading.classList.remove('hidden');
            homeError.classList.add('hidden');
            noVideosMessage.classList.add('hidden');
            videoFeedContainer.innerHTML = ''; // Pichle videos clear karein

            console.log("Firestore se videos fetch kar rahe hain...");
            try {
                // Public videos ke liye path: /artifacts/{appId}/public/data/videos
                const videosColRef = collection(db, `artifacts/${appId}/public/data/videos`);
                const q = query(videosColRef);

                onSnapshot(q, async (snapshot) => {
                    let videoList = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));

                    // Client-side par timestamp (ghatate kram) se sort karein
                    videoList.sort((a, b) => (b.timestamp?.toDate() || 0) - (a.timestamp?.toDate() || 0));

                    console.log("Fetched videos:", videoList);

                    if (videoList.length === 0) {
                        noVideosMessage.classList.remove('hidden');
                        homeLoading.classList.add('hidden');
                        return;
                    }

                    videoFeedContainer.innerHTML = ''; // Existing videos ko re-rendering se pehle clear karein
                    for (const video of videoList) {
                        const videoCard = createVideoCardElement(video);
                        videoFeedContainer.appendChild(videoCard);
                    }
                    homeLoading.classList.add('hidden');
                    noVideosMessage.classList.add('hidden');

                }, (err) => {
                    console.error("Videos ke liye onSnapshot mein error:", err);
                    homeError.textContent = `Videos load karne mein asafal: ${err.message}. Firebase security rules check karein.`;
                    homeError.classList.remove('hidden');
                    homeLoading.classList.add('hidden');
                });

            } catch (error) {
                console.error("Video feed listener set up karne mein error:", error);
                homeError.textContent = `Error: ${error.message}. Real-time listener set up nahi ho paya.`;
                homeError.classList.remove('hidden');
                homeLoading.classList.add('hidden');
            }
        }

        /**
         * Ek single video card ke liye HTML element banata hai.
         * @param {object} video - Video data.
         * @returns {HTMLElement} Video card element.
         */
        function createVideoCardElement(video) {
            console.log("Video card bana rahe hain:", video.id, "Title:", video.title);
            const videoCard = document.createElement('div');
            videoCard.id = `video-card-${video.id}`;
            videoCard.className = 'relative flex-shrink-0 w-full h-full snap-center bg-gray-900 rounded-lg overflow-hidden border border-gray-800 shadow-xl';

            const youTubeInfo = getYouTubeInfo(video.youtubeUrl);
            const thumbnailUrl = youTubeInfo ? youTubeInfo.thumbnailUrl : 'https://placehold.co/1280x720/000000/FFFFFF?text=Invalid+Video+URL';

            videoCard.innerHTML = `
                <!-- Video Player Container -->
                <div id="player-container-${video.id}" class="relative w-full h-full bg-black flex items-center justify-center overflow-hidden">
                    <!-- Ad load hone ke liye thumbnail placeholder -->
                    <img id="thumbnail-${video.id}" src="${thumbnailUrl}" alt="Video Thumbnail" class="absolute inset-0 w-full h-full object-cover z-10" />
                    <!-- Ad Overlay -->
                    <div id="ad-overlay-${video.id}" class="absolute inset-0 bg-black bg-opacity-75 flex items-center justify-center z-40 text-white text-lg font-bold hidden">
                        <svg class="animate-pulse h-6 w-6 mr-2 text-orange-400" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM9.555 7.168A1 1 0 008 8v4a1 1 0 001.555.832l3-2a1 1 0 000-1.664l-3-2z" clip-rule="evenodd"></path></svg>
                        <span class="text-gray-300">Ad chal raha hai...</span>
                    </div>
                    <!-- Ad khatm hone ke baad ad message -->
                    <div id="ad-message-${video.id}" class="absolute top-4 left-1/2 -translate-x-1/2 bg-green-600 text-white px-4 py-2 rounded-full text-sm font-semibold animate-fade-in-out z-40 hidden">
                        Video jald hi chalega!
                    </div>
                    <!-- Asal YouTube iframe yahaan dynamically add kiya jayega -->
                    <div id="youtube-iframe-wrapper-${video.id}" class="w-full h-full hidden"></div>
                </div>

                <!-- Video ki jaankari aur Controls -->
                <div class="absolute bottom-0 left-0 right-0 p-4 bg-gradient-to-t from-black to-transparent flex flex-col justify-end text-white z-10">
                    <!-- Adstreaa Banner 468x60 -->
                    <div class="mb-4 w-full flex justify-center">
                        <div id="adstreaa-banner-468x60-${video.id}" class="w-[468px] h-[60px] bg-gray-800 rounded-md flex items-center justify-center text-xs text-gray-400 border border-gray-700">
                            Banner 468x60 Ad (Adstreaa Placeholder)
                        </div>
                    </div>

                    <h2 class="text-xl font-bold mb-2 text-orange-300 drop-shadow">${video.title}</h2>
                    <p class="text-sm text-gray-300 mb-4 drop-shadow">By ${video.userName || 'Anonymous User'} | ${video.viewsCount || 0} views</p>

                    <!-- Social Buttons -->
                    <div class="flex items-center space-x-6 text-xl">
                        <button id="like-button-${video.id}" class="flex items-center space-x-1 p-2 rounded-full hover:bg-gray-700 transition duration-200">
                            <svg class="h-6 w-6 text-gray-300 like-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>
                            </svg>
                            <span class="text-sm like-count">${video.likesCount || 0}</span>
                        </button>
                        <button id="comment-button-${video.id}" class="flex items-center space-x-1 p-2 rounded-full hover:bg-gray-700 transition duration-200">
                            <svg class="h-6 w-6 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                            </svg>
                            <span class="text-sm">Comments</span>
                        </button>
                        <button class="flex items-center space-x-1 p-2 rounded-full hover:bg-gray-700 transition duration-200">
                            <svg class="h-6 w-6 text-gray-300" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.516 3.832a3 3 0 00.512-1.632V12c0-.36-.062-.716-.184-1.049m0 2.098L8.684 10.658m10.158-1.342a3 3 0 110-2.684m0 2.684l-6.516-3.832a3 3 0 00-.512 1.632V12c0 .36.062.716.184 1.049m0-2.098L18.842 8.658"></path>
                            </svg>
                            <span class="text-sm">Share Karein</span>
                        </button>
                    </div>

                    <!-- Hilltops MultiTag: Banner 300x250 -->
                    <div class="mt-4 w-full flex justify-center">
                        <div id="hilltops-banner-300x250-${video.id}" class="w-[300px] h-[250px] bg-gray-800 rounded-md flex items-center justify-center text-xs text-gray-400 border border-gray-700">
                            Banner 300x250 Ad (Hilltops Placeholder)
                        </div>
                    </div>
                </div>
            `;

            // DOM mein element hone ke baad event listeners attach karein
            videoCard.querySelector(`#like-button-${video.id}`).addEventListener('click', () => handleLike(video.id));
            videoCard.querySelector(`#comment-button-${video.id}`).addEventListener('click', () => openCommentModal(video.id));

            // Real-time like count listener set up karein
            const likeCountSpan = videoCard.querySelector(`#like-button-${video.id} .like-count`);
            const likeIcon = videoCard.querySelector(`#like-button-${video.id} .like-icon`);
            const videoRef = doc(db, `artifacts/${appId}/public/data/videos/${video.id}`);
            onSnapshot(videoRef, (docSnap) => {
                if (docSnap.exists()) {
                    const currentLikes = docSnap.data().likesCount || 0;
                    likeCountSpan.textContent = currentLikes;
                }
            });

            // Shuruaati like status check karein
            if (currentUserId && db) { // Sunischit karein ki db available hai
                const userLikeRef = doc(db, `artifacts/${appId}/public/data/likes/${video.id}_${currentUserId}`);
                getDoc(userLikeRef).then(docSnap => {
                    if (docSnap.exists()) {
                        likeIcon.classList.remove('text-gray-300');
                        likeIcon.classList.add('text-red-500', 'fill-current');
                        // Bhare hue heart ke liye SVG path replace karein
                        likeIcon.innerHTML = '<path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78L12 21.23l8.84-8.64a5.5 5.5 0 000-7.78z" fill="currentColor"></path>';
                    }
                }).catch(error => console.error("Shuruaati like status check karne mein error:", error));
            }

            // Ad ke baad video chalayein
            const playerContainer = videoCard.querySelector(`#player-container-${video.id}`);
            const adOverlay = videoCard.querySelector(`#ad-overlay-${video.id}`);
            const thumbnail = videoCard.querySelector(`#thumbnail-${video.id}`);
            const youtubeIframeWrapper = videoCard.querySelector(`#youtube-iframe-wrapper-${video.id}`);
            const adMessage = videoCard.querySelector(`#ad-message-${video.id}`);

            // Inline ad scripts ko unke respective containers mein inject karein
            const adstreaaBanner468x60Div = videoCard.querySelector(`#adstreaa-banner-468x60-${video.id}`);
            if (adstreaaBanner468x60Div) {
                const scriptText = `
                    atOptions = {  
                        'key' : '7281653bd62d5d460d6daa8793f19c5e',  
                        'format' : 'iframe',  
                        'height' : 60,  
                        'width' : 468,  
                        'params' : {}  
                    };  
                `;
                const script1 = document.createElement('script');
                script1.type = 'text/javascript';
                script1.textContent = scriptText;
                adstreaaBanner468x60Div.appendChild(script1);

                const script2 = document.createElement('script');
                script2.type = 'text/javascript';
                script2.src = '//www.highperformanceformat.com/7281653bd62d5d460d6daa8793f19c5e/invoke.js';
                adstreaaBanner468x60Div.appendChild(script2);
            }

            const hilltopsBanner300x250Div = videoCard.querySelector(`#hilltops-banner-300x250-${video.id}`);
            if (hilltopsBanner300x250Div) {
                const scriptFn = `
                    (function(zrot){     
                    var d = document,     
                    s = d.createElement('script'),     
                    l = d.scripts[d.scripts.length - 1];     
                    s.settings = zrot || {};     
                    s.src = "//definitive-priority.com/bOX/VYsBd.Golu0eYpWdco/reFmA9WujZeU/lTkBPQTiYH0IMrj_Q_1BNsjJI-tTNujcQ/yrNSDxU/2SMowA";     
                    s.async = true;     
                    s.referrerPolicy = 'no-referrer-when-downgrade';     
                    l.parentNode.insertBefore(s, l);     
                    })({});
                `;
                const script = document.createElement('script');
                script.textContent = scriptFn;
                hilltopsBanner300x250Div.appendChild(script);
            }


            playVideoWithAd(video, playerContainer, adOverlay, thumbnail, youtubeIframeWrapper, adMessage);

            return videoCard;
        }

        /**
         * Profile page ko user-specific data ke saath update karta hai.
         */
        async function updateProfilePage() {
            if (!authReady || !db || !currentUserId) {
                console.warn("Firebase ya user profile page ke liye taiyar nahi. updateProfilePage ko rok rahe hain.");
                profileLoading.classList.add('hidden');
                profileError.textContent = "Kripya apni profile dekhne ke liye sign in karein.";
                profileError.classList.remove('hidden');
                return;
            }

            profileLoading.classList.remove('hidden');
            profileError.classList.add('hidden');
            noUserVideosMessage.classList.add('hidden');
            userVideosContainer.innerHTML = ''; // Pichle videos clear karein

            console.log("User ke liye profile page update kar rahe hain:", currentUserId);
            try {
                // User details fetch karein
                const userProfileRef = doc(db, `artifacts/${appId}/users/${currentUserId}/profile/${currentUserId}`);
                const userDoc = await getDoc(userProfileRef);
                const username = userDoc.exists() ? userDoc.data().username : `User: ${currentUserId.substring(0, 8)}...`;
                profileUsername.textContent = username;
                profileUserId.textContent = currentUserId;
                document.getElementById('profile-avatar').src = `https://placehold.co/100x100/374151/E5E7EB?text=${username.charAt(0)}`;


                // Is user dwara upload kiye gaye videos fetch karein
                const videosColRef = collection(db, `artifacts/${appId}/public/data/videos`);
                const q = query(videosColRef, where('userId', '==', currentUserId));

                onSnapshot(q, (snapshot) => {
                    let userVideos = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));

                    // Client-side par timestamp (ghatate kram) se sort karein
                    userVideos.sort((a, b) => (b.timestamp?.toDate() || 0) - (a.timestamp?.toDate() || 0));

                    profileUploadsCount.textContent = userVideos.length;
                    userVideosContainer.innerHTML = ''; // Pichla clear karein

                    if (userVideos.length === 0) {
                        noUserVideosMessage.classList.remove('hidden');
                    } else {
                        noUserVideosMessage.classList.add('hidden');
                        userVideos.forEach(video => {
                            const youTubeInfo = getYouTubeInfo(video.youtubeUrl);
                            const thumbnailUrl = youTubeInfo ? youTubeInfo.thumbnailUrl : 'https://placehold.co/480x360/000/FFF?text=Video+Thumbnail';
                            const videoElement = `
                                <div class="bg-gray-900 rounded-lg overflow-hidden shadow-md border border-gray-800 transform hover:scale-105 transition-transform duration-200 cursor-pointer">
                                    <img src="${thumbnailUrl}" alt="${video.title}" class="w-full h-48 object-cover" />
                                    <div class="p-4">
                                        <h3 class="text-lg font-semibold text-orange-300 truncate">${video.title}</h3>
                                        <p class="text-sm text-gray-400 mt-1">${video.viewsCount || 0} views</p>
                                    </div>
                                </div>
                            `;
                            userVideosContainer.insertAdjacentHTML('beforeend', videoElement);
                        });
                    }
                    profileLoading.classList.add('hidden');
                }, (err) => {
                    console.error("User videos ke liye onSnapshot mein error:", err);
                    profileError.textContent = `User videos load karne mein asafal: ${err.message}. Firebase security rules check karein.`;
                    profileError.classList.remove('hidden');
                    profileLoading.classList.add('hidden');
                });

            } catch (error) {
                console.error("Profile page update karne mein error:", error);
                profileError.textContent = `Error: ${error.message}`;
                profileError.classList.remove('hidden');
                profileLoading.classList.add('hidden');
            }
        }


        // --- VAST Ad Integration Logic (Google IMA SDK) ---

        let currentAdManager = null;
        let isAdPlaying = false; // Global flag batane ke liye ki ek ad chal raha hai

        /**
         * Video dikhane se pehle Google IMA SDK ka upyog karke VAST ad chalata hai.
         * @param {object} video - Video data.
         * @param {HTMLElement} playerContainer - Video/ad ke liye mukhy container.
         * @param {HTMLElement} adOverlay - Ad chalte samay dikhane wala element.
         * @param {HTMLElement} thumbnail - Thumbnail element.
         * @param {HTMLElement} youtubeIframeWrapper - YouTube iframe ke liye wrapper.
         * @param {HTMLElement} adMessageElement - Ad ke baad message dikhane wala element.
         */
        function playVideoWithAd(video, playerContainer, adOverlay, thumbnail, youtubeIframeWrapper, adMessageElement) {
            console.log("Video ke liye ad chalane ka prayas kar rahe hain:", video.id);

            // Sunischit karein ki IMA SDK load ho gaya hai
            if (typeof google === 'undefined' || !google.ima) {
                console.error("Google IMA SDK load nahi hua. Ad chhod rahe hain, seedhe video chala rahe hain.");
                showCustomModal('Ad Error', 'Ad service available nahi hai. Seedhe video chala rahe hain.', false);
                cleanupAdAndShowVideo(video, playerContainer, thumbnail, youtubeIframeWrapper, adMessageElement, true);
                return;
            }

            // Sunischit karein ki koi pichla ad manager destroy ho gaya hai
            if (currentAdManager) {
                currentAdManager.destroy();
                currentAdManager = null;
            }

            // Global IMA ad container dikhayein aur local video player elements ko temporarily chhupayein
            imaAdContainer.style.display = 'flex'; // Global ad container dikhayein
            playerContainer.style.display = 'none'; // Global ad ke dauraan current video card ka player container chhupayein

            isAdPlaying = true;
            adOverlay.classList.remove('hidden'); // Local ad overlay bhi dikhayein, ek visual indicator ke roop mein
            thumbnail.classList.remove('hidden');
            youtubeIframeWrapper.classList.add('hidden');
            adMessageElement.classList.add('hidden');


            const adDisplayContainer = new google.ima.AdDisplayContainer(imaAdContainer);
            const adsLoader = new google.ima.AdsLoader(adDisplayContainer);

            // Ad errors ke liye sunein
            adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR, (adErrorEvent) => {
                console.error("adsLoader se Ad error:", adErrorEvent.getError().getMessage());
                showCustomModal('Ad Playback Error', 'Ad chalane mein asafal. Video par jaari rakh rahe hain.', false);
                cleanupAdAndShowVideo(video, playerContainer, thumbnail, youtubeIframeWrapper, adMessageElement, true); // True ad chhodne ke liye
            }, false);

            // Ads loaded event ke liye sunein
            adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED, (adsManagerLoadedEvent) => {
                console.log("AdsManager Loaded event fire ho gaya.");
                const adsManager = adsManagerLoadedEvent.getAdsManager();
                currentAdManager = adsManager;

                adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR, (adErrorEvent) => {
                    console.error("Ad manager error:", adErrorEvent.getError().getMessage());
                    cleanupAdAndShowVideo(video, playerContainer, thumbnail, youtubeIframeWrapper, adMessageElement, true); // True ad chhodne ke liye
                }, false);

                adsManager.addEventListener(google.ima.AdEvent.Type.ALL_ADS_COMPLETED, () => {
                    console.log("VAST ad poora ho gaya.");
                    cleanupAdAndShowVideo(video, playerContainer, thumbnail, youtubeIframeWrapper, adMessageElement, false); // False batane ke liye ki ad poora ho gaya
                }, false);

                adsManager.addEventListener(google.ima.AdEvent.Type.LOADED, () => {
                    console.log("Ad LOADED event (start hone se pehle)");
                }, false);

                adsManager.addEventListener(google.ima.AdEvent.Type.AD_BREAK_READY, () => {
                    console.log("Ad break taiyar hai. Ad playback shuru kar rahe hain.");
                }, false);


                try {
                    adsManager.init(imaAdContainer.offsetWidth, imaAdContainer.offsetHeight, google.ima.ViewMode.NORMAL);
                    adsManager.start();
                    console.log("VAST ad playback shuru kiya gaya.");
                } catch (adError) {
                    console.error("AdsManager shuru nahi kiya ja saka:", adError);
                    cleanupAdAndShowVideo(video, playerContainer, thumbnail, youtubeIframeWrapper, adMessageElement, true); // True ad chhodne ke liye
                }
            }, false);

            // Ads ka anurodh karein
            const adsRequest = new google.ima.AdsRequest();
            adsRequest.adTagUrl = vastAdTagUrl;
            adsRequest.linearAdSlotWidth = imaAdContainer.offsetWidth;
            adsRequest.linearAdSlotHeight = imaAdContainer.offsetHeight;
            adsRequest.nonLinearAdSlotWidth = imaAdContainer.offsetWidth;
            adsRequest.nonLinearAdSlotHeight = imaAdContainer.offsetHeight;
            adsRequest.setAdWillAutoPlay(true); // Indicate karein ki ads autoplay honge

            adDisplayContainer.initialize(); // Ads anurodh karne se pehle ad container ko initialize karein
            adsLoader.requestAds(adsRequest);
            console.log("Ad request bheja gaya:", video.id);
        }

        /**
         * Ad manager ko saaf karta hai aur video player dikhata hai.
         * @param {object} video - Video data.
         * @param {HTMLElement} playerContainer - Video/ad ke liye mukhy container.
         * @param {HTMLElement} thumbnail - Thumbnail element.
         * @param {HTMLElement} youtubeIframeWrapper - YouTube iframe ke liye wrapper.
         * @param {HTMLElement} adMessageElement - Ad ke baad message dikhane wala element.
         * @param {boolean} skipAd - Agar true, toh ad chhod diya gaya ya asafal raha, bas video dikhayein.
         */
        function cleanupAdAndShowVideo(video, playerContainer, thumbnail, youtubeIframeWrapper, adMessageElement, skipAd = false) {
            console.log("Ad saaf kar rahe hain aur video dikha rahe hain:", video.id, "Ad Chhoda:", skipAd);
            if (currentAdManager) {
                currentAdManager.destroy();
                currentAdManager = null;
            }
            imaAdContainer.style.display = 'none'; // Global ad container chhupayein
            playerContainer.style.display = 'flex'; // Video card ka player container dikhayein

            isAdPlaying = false;
            adOverlay.classList.add('hidden'); // Local ad overlay chhupayein
            thumbnail.classList.add('hidden'); // Thumbnail chhupayein
            youtubeIframeWrapper.classList.remove('hidden'); // Iframe wrapper dikhayein

            // YouTube iframe add karein agar pehle se maujood nahi hai ya ad chhod diya gaya/asafal raha
            let iframe = youtubeIframeWrapper.querySelector('iframe');
            if (!iframe) {
                const youTubeInfo = getYouTubeInfo(video.youtubeUrl);
                if (youTubeInfo) {
                    iframe = document.createElement('iframe');
                    iframe.className = "w-full h-full object-cover";
                    iframe.src = youTubeInfo.embedUrl;
                    iframe.frameBorder = "0";
                    iframe.allow = "autoplay; encrypted-media; gyroscope; picture-in-picture";
                    iframe.allowFullscreen = true;
                    iframe.title = "YouTube video player";
                    youtubeIframeWrapper.appendChild(iframe);
                } else {
                    youtubeIframeWrapper.innerHTML = `<div class="text-red-500 text-center">Invalid YouTube URL</div>`;
                    console.error("Invalid YouTube URL for video:", video.id, video.youtubeUrl);
                }
            } else if (skipAd) {
                 // Agar ad chhod diya gaya/asafal raha aur iframe pehle se maujood hai, toh sunischit karein ki woh chalna shuru kare
                 const youTubeInfo = getYouTubeInfo(video.youtubeUrl);
                 if (youTubeInfo) {
                    iframe.src = youTubeInfo.embedUrl; // Autoplay/reload ko force karne ke liye src ko dobara set karein
                 }
            }


            adMessageElement.classList.remove('hidden');
            setTimeout(() => {
                adMessageElement.classList.add('hidden');
            }, 3000); // 3 seconds ke baad message chhupayein
        }


        // --- Social Interactions (Like, Comment) ---

        /**
         * Ek video ke liye like/unlike action ko handle karta hai.
         * @param {string} videoId - Video ki ID.
         */
        async function handleLike(videoId) {
            if (!currentUserId || !db) {
                showCustomModal('Action Zaroori', 'Kripya videos ko like karne ke liye sign in karein.', false);
                return;
            }
            console.log(`Video ${videoId} ko like/unlike kar rahe hain user ${currentUserId} dwara`);

            const likeRef = doc(db, `artifacts/${appId}/public/data/likes/${videoId}_${currentUserId}`);
            const videoRef = doc(db, `artifacts/${appId}/public/data/videos/${videoId}`);

            try {
                const docSnap = await getDoc(likeRef);
                const isLiked = docSnap.exists();

                const likeIcon = document.querySelector(`#like-button-${videoId} .like-icon`);
                let currentLikes = parseInt(document.querySelector(`#like-button-${videoId} .like-count`).textContent);

                if (isLiked) {
                    // Unlike karein
                    await deleteDoc(likeRef);
                    await updateDoc(videoRef, {
                        likesCount: Math.max(0, currentLikes - 1)
                    });
                    likeIcon.classList.remove('text-red-500', 'fill-current');
                    likeIcon.classList.add('text-gray-300');
                    likeIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"></path>';
                    console.log(`Video ${videoId} unlike ho gaya.`);
                } else {
                    // Like karein
                    await setDoc(likeRef, { videoId: videoId, userId: currentUserId, timestamp: serverTimestamp() });
                    await updateDoc(videoRef, {
                        likesCount: (currentLikes || 0) + 1
                    });
                    likeIcon.classList.remove('text-gray-300');
                    likeIcon.classList.add('text-red-500', 'fill-current');
                    likeIcon.innerHTML = '<path d="M20.84 4.61a5.5 5.5 0 00-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 00-7.78 7.78L12 21.23l8.84-8.64a5.5 5.5 0 000-7.78z" fill="currentColor"></path>';
                    console.log(`Video ${videoId} like ho gaya.`);
                }
            } catch (error) {
                console.error("Like toggle karne mein error:", error);
                showCustomModal('Error', `Like update karne mein asafal: ${error.message}`, false);
            }
        }

        /**
         * Ek specific video ke liye comment modal kholta hai.
         * @param {string} videoId - Comment karne ke liye video ki ID.
         */
        function openCommentModal(videoId) {
            currentVideoIdForComments = videoId;
            commentModal.classList.remove('hidden');
            loadComments(videoId);
        }

        /**
         * Ek diye gaye video ke liye comments load aur display karta hai.
         * @param {string} videoId - Video ki ID.
         */
        async function loadComments(videoId) {
            commentList.innerHTML = ''; // Pichle comments clear karein
            commentLoading.classList.remove('hidden');
            noCommentsMessage.classList.add('hidden');

            if (!db) {
                console.error("Firestore DB comments ke liye available nahi.");
                commentList.innerHTML = `<p class="text-red-500 text-center">App database taiyar nahi.</p>`;
                commentLoading.classList.add('hidden');
                return;
            }

            try {
                const commentsColRef = collection(db, `artifacts/${appId}/public/data/comments`);
                const q = query(commentsColRef, where('videoId', '==', videoId));

                onSnapshot(q, async (snapshot) => {
                    let fetchedComments = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));

                    // Comments ke liye usernames fetch karein
                    const commentsWithUsernames = await Promise.all(fetchedComments.map(async (comment) => {
                        const userProfileRef = doc(db, `artifacts/${appId}/users/${comment.userId}/profile/${comment.userId}`);
                        try {
                            const userDoc = await getDoc(userProfileRef);
                            const username = userDoc.exists() ? userDoc.data().username : 'Anonymous';
                            return { ...comment, username };
                        } catch (profileFetchError) {
                            console.warn("Comment ke liye username fetch nahi kar saka:", comment.userId, profileFetchError);
                            return { ...comment, username: 'Anonymous' }; // Fallback
                        }
                    }));

                    // Timestamp (ghatate kram) se sort karein
                    commentsWithUsernames.sort((a, b) => (b.timestamp?.toDate() || 0) - (a.timestamp?.toDate() || 0));

                    commentList.innerHTML = ''; // Dubara clear karein taki multiple snapshots se duplicates na aayein
                    if (commentsWithUsernames.length === 0) {
                        noCommentsMessage.classList.remove('hidden');
                    } else {
                        noCommentsMessage.classList.add('hidden');
                        commentsWithUsernames.forEach(comment => {
                            const commentElement = `
                                <div class="bg-gray-700 rounded-lg p-3 mb-3 shadow-sm border border-gray-600">
                                    <p class="text-gray-200 text-sm mb-1">${comment.text}</p>
                                    <p class="text-xs text-gray-400">
                                        <span class="font-semibold text-orange-300">${comment.username}</span> • ${new Date(comment.timestamp?.toDate()).toLocaleString()}
                                    </p>
                                </div>
                            `;
                            commentList.insertAdjacentHTML('beforeend', commentElement);
                        });
                    }
                    commentLoading.classList.add('hidden');
                }, (err) => {
                    console.error("Comments ke liye onSnapshot mein error:", err);
                    commentList.innerHTML = `<p class="text-red-500 text-center">Comments load karne mein asafal: ${err.message}. Firebase security rules check karein.</p>`;
                    commentLoading.classList.add('hidden');
                });
            } catch (error) {
                console.error("Comment listener set up karne mein error:", error);
                commentList.innerHTML = `<p class="text-red-500 text-center">Comments fetch karne mein error: ${error.message}.</p>`;
                commentLoading.classList.add('hidden');
            }
        }

        /**
         * Ek video mein naya comment add karta hai.
         */
        async function addComment() {
            if (!currentUserId || !db) {
                showCustomModal('Action Zaroori', 'Kripya comments add karne ke liye sign in karein.', false);
                return;
            }
            const commentText = newCommentInput.value.trim();
            if (!commentText) {
                showCustomModal('Input Zaroori', 'Kripya ek comment enter karein.', false);
                return;
            }
            if (!currentVideoIdForComments) {
                console.error("Comment ke liye koi video ID nirdisht nahi.");
                showCustomModal('Error', 'Comment add nahi kar saka: Koi video chuna nahi gaya.', false);
                return;
            }

            try {
                const commentsColRef = collection(db, `artifacts/${appId}/public/data/comments`);
                await addDoc(commentsColRef, {
                    videoId: currentVideoIdForComments,
                    userId: currentUserId,
                    text: commentText,
                    timestamp: serverTimestamp()
                });
                newCommentInput.value = ''; // Input clear karein
                console.log("Comment safaltaapoorvak add ho gaya.");
            } catch (error) {
                console.error("Comment add karne mein error:", error);
                showCustomModal('Error', `Comment add karne mein asafal: ${error.message}`, false);
            }
        }


        // --- Video Upload Modal Logic ---

        /**
         * Video upload modal kholta hai.
         */
        function openUploadModal() {
            if (!currentUserId) {
                showCustomModal('Action Zaroori', 'Videos upload karne ke liye kripya sign in karein ya guest ke roop mein jaari rakhein.', false);
                return;
            }
            uploadVideoModal.classList.remove('hidden');
        }

        /**
         * Video upload form submission ko handle karta hai.
         * @param {Event} e - Form submission event.
         */
        async function handleUploadSubmit(e) {
            e.preventDefault();
            uploadErrorMessage.classList.add('hidden');
            uploadSubmitButton.disabled = true;
            uploadButtonText.textContent = 'Upload ho raha hai...';
            uploadLoadingSpinner.classList.remove('hidden');

            const videoUrl = videoUrlInput.value.trim();
            const videoTitle = videoTitleInput.value.trim();

            if (!videoUrl || !videoTitle) {
                uploadErrorMessage.textContent = "Kripya video URL aur title dono enter karein.";
                uploadErrorMessage.classList.remove('hidden');
                uploadSubmitButton.disabled = false;
                uploadButtonText.textContent = 'Video Upload Karein';
                uploadLoadingSpinner.classList.add('hidden');
                return;
            }

            const youTubeInfo = getYouTubeInfo(videoUrl);
            if (!youTubeInfo) {
                uploadErrorMessage.textContent = "Kripya ek valid YouTube video URL enter karein.";
                uploadErrorMessage.classList.remove('hidden');
                uploadSubmitButton.disabled = false;
                uploadButtonText.textContent = 'Video Upload Karein';
                uploadLoadingSpinner.classList.add('hidden');
                return;
            }

            if (!currentUserId || !db) {
                uploadErrorMessage.textContent = "App taiyar nahi ya user login nahi hai.";
                uploadErrorMessage.classList.remove('hidden');
                uploadSubmitButton.disabled = false;
                uploadButtonText.textContent = 'Video Upload Karein';
                uploadLoadingSpinner.classList.add('hidden');
                return;
            }

            try {
                // Current user ka username fetch karein
                const userProfileRef = doc(db, `artifacts/${appId}/users/${currentUserId}/profile/${currentUserId}`);
                const userDoc = await getDoc(userProfileRef);
                const username = userDoc.exists() ? userDoc.data().username : 'Anonymous';

                const videosColRef = collection(db, `artifacts/${appId}/public/data/videos`);
                await addDoc(videosColRef, {
                    userId: currentUserId,
                    userName: username,
                    youtubeUrl: videoUrl,
                    title: videoTitle,
                    thumbnailUrl: youTubeInfo.thumbnailUrl,
                    viewsCount: 0,
                    likesCount: 0,
                    timestamp: serverTimestamp()
                });

                showCustomModal('Safalta!', 'Video safaltaapoorvak upload ho gaya. Yeh jald hi feed mein dikhega.', false, null, () => {
                    closeModal('upload');
                });
                uploadVideoForm.reset(); // Form clear karein
            } catch (error) {
                console.error("Video upload karne mein error:", error);
                uploadErrorMessage.textContent = `Video upload karne mein asafal: ${error.message}. Firebase security rules check karein.`;
                uploadErrorMessage.classList.remove('hidden');
            } finally {
                uploadSubmitButton.disabled = false;
                uploadButtonText.textContent = 'Video Upload Karein';
                uploadLoadingSpinner.classList.add('hidden');
            }
        }


        // --- Withdraw Modal Logic (Simulated) ---

        /**
         * Withdraw modal kholta hai.
         */
        function openWithdrawModal() {
            if (!currentUserId) {
                showCustomModal('Action Zaroori', 'Nikasi ka anurodh karne ke liye kripya sign in karein.', false);
                return;
            }
            withdrawModal.classList.remove('hidden');
        }

        /**
         * Nikasi form submission ko handle karta hai (simulated).
         * @param {Event} e - Form submission event.
         */
        async function handleWithdrawSubmit(e) {
            e.preventDefault();
            withdrawErrorMessage.classList.add('hidden');
            withdrawSubmitButton.disabled = true;
            withdrawButtonText.textContent = 'Submit ho raha hai...';
            withdrawLoadingSpinner.classList.remove('hidden');

            const amount = parseFloat(withdrawAmountInput.value);
            const upiId = upiIdInput.value.trim();

            if (!amount || !upiId) {
                withdrawErrorMessage.textContent = 'Kripya sabhi fields bharein.';
                withdrawErrorMessage.classList.remove('hidden');
                withdrawSubmitButton.disabled = false;
                withdrawButtonText.textContent = 'Nikasi Ka Anurodh Karein';
                withdrawLoadingSpinner.classList.add('hidden');
                return;
            }
            if (amount < 100) {
                withdrawErrorMessage.textContent = 'Minimum nikasi rashi ₹100 hai.';
                withdrawErrorMessage.classList.remove('hidden');
                withdrawSubmitButton.disabled = false;
                withdrawButtonText.textContent = 'Nikasi Ka Anurodh Karein';
                withdrawLoadingSpinner.classList.add('hidden');
                return;
            }
             if (!currentUserId) {
                withdrawErrorMessage.textContent = "User login nahi hai. Nikasi prakriya nahi kar sakte.";
                withdrawErrorMessage.classList.remove('hidden');
                withdrawSubmitButton.disabled = false;
                withdrawButtonText.textContent = 'Nikasi Ka Anurodh Karein';
                withdrawLoadingSpinner.classList.add('hidden');
                return;
            }


            try {
                // Nikasi anurodh ke liye API call simulate karein
                console.log(`Nikasi Anurodh: User ${currentUserId}, Rashi: ₹${amount}, UPI ID: ${upiId}`);
                await new Promise(resolve => setTimeout(resolve, 2000)); // 2-second delay simulate karein

                showCustomModal('Anurodh Bhej Diya!', 'Nikasi ka anurodh safaltaapoorvak bhej diya gaya! Payment UPI ke madhyam se manually bheja jayega.', false, null, () => {
                    closeModal('withdraw');
                });
                withdrawForm.reset(); // Form clear karein
            } catch (error) {
                console.error("Nikasi mein error:", error);
                withdrawErrorMessage.textContent = `Nikasi ka anurodh submit karne mein asafal: ${error.message}`;
                withdrawErrorMessage.classList.remove('hidden');
            } finally {
                withdrawSubmitButton.disabled = false;
                withdrawButtonText.textContent = 'Nikasi Ka Anurodh Karein';
                withdrawLoadingSpinner.classList.add('hidden');
            }
        }

        /**
         * User sign out ko handle karta hai.
         */
        async function handleSignOut() {
            try {
                await signOut(auth);
                console.log("Safaltaapoorvak sign out ho gaye.");
                currentUserId = null; // Sign out ke baad userId clear karein
                showPage('home'); // Home page par redirect karein
                showCustomModal('Sign Out Ho Gaye', 'Aap safaltaapoorvak sign out ho gaye hain.', false);
            } catch (error) {
                console.error("Sign out karne mein error:", error);
                showCustomModal('Sign Out Error', `Sign out karne mein asafal: ${error.message}`, false);
            }
        }


        // --- Authentication Modal Functions ---

        /**
         * Auth modal mein active tab ko Login aur Sign Up ke beech switch karta hai.
         * @param {string} type - 'login' ya 'signup'.
         */
        function switchAuthTab(type) {
            if (type === 'login') {
                authTabLogin.style.backgroundColor = '#f97316';
                authTabLogin.style.color = 'white';
                authTabSignup.style.backgroundColor = 'rgb(75 85 99)'; // gray-700
                authTabSignup.style.color = 'rgb(209 213 219)'; // gray-300
                loginForm.classList.remove('hidden');
                signupForm.classList.add('hidden');
            } else { // type === 'signup'
                authTabSignup.style.backgroundColor = '#f97316';
                authTabSignup.style.color = 'white';
                authTabLogin.style.backgroundColor = 'rgb(75 85 99)'; // gray-700
                authTabLogin.style.color = 'rgb(209 213 219)'; // gray-300
                signupForm.classList.remove('hidden');
                loginForm.classList.add('hidden');
            }
            loginErrorMessage.classList.add('hidden');
            signupErrorMessage.classList.add('hidden');
        }

        /**
         * Email/Password Sign Up ko handle karta hai.
         * @param {Event} e - Form submission event.
         */
        async function handleEmailSignup(e) {
            e.preventDefault();
            signupErrorMessage.classList.add('hidden');
            signupSubmitButton.disabled = true;
            signupButtonText.textContent = 'Sign Up ho raha hai...';
            signupLoadingSpinner.classList.remove('hidden');

            const email = signupEmailInput.value.trim();
            const password = signupPasswordInput.value.trim();

            if (!email || !password) {
                signupErrorMessage.textContent = "Kripya email aur password dono enter karein.";
                signupErrorMessage.classList.remove('hidden');
                signupSubmitButton.disabled = false;
                signupButtonText.textContent = 'Sign Up Karein';
                signupLoadingSpinner.classList.add('hidden');
                return;
            }
            if (password.length < 6) {
                signupErrorMessage.textContent = "Password kam se kam 6 akshar lamba hona chahiye.";
                signupErrorMessage.classList.remove('hidden');
                signupSubmitButton.disabled = false;
                signupButtonText.textContent = 'Sign Up Karein';
                signupLoadingSpinner.classList.add('hidden');
                return;
            }

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                console.log("User signed up:", user.uid);

                // Email verification bhej de
                await sendEmailVerification(user);
                showCustomModal('Verification Bhej Diya', `Ek verification email ${user.email} par bhej diya gaya hai. Kripya login karne se pehle apna email verify karein.`, false, null, () => {
                    closeModal('auth'); // Safal signup aur email bhejne par auth modal band karein
                });
                signupForm.reset();
            } catch (error) {
                console.error("Signup error:", error);
                let errorMessage = "Sign up karne mein asafal.";
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage = "Yeh email pehle se hi upyog mein hai. Login karne ka prayas karein.";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "Invalid email address.";
                } else if (error.code === 'auth/weak-password') {
                    errorMessage = "Password bahut kamzor hai.";
                }
                signupErrorMessage.textContent = errorMessage;
                signupErrorMessage.classList.remove('hidden');
            } finally {
                signupSubmitButton.disabled = false;
                signupButtonText.textContent = 'Sign Up Karein';
                signupLoadingSpinner.classList.add('hidden');
            }
        }

        /**
         * Email/Password Login ko handle karta hai.
         * @param {Event} e - Form submission event.
         */
        async function handleEmailLogin(e) {
            e.preventDefault();
            loginErrorMessage.classList.add('hidden');
            loginSubmitButton.disabled = true;
            loginButtonText.textContent = 'Login ho raha hai...';
            loginLoadingSpinner.classList.remove('hidden');

            const email = loginEmailInput.value.trim();
            const password = loginPasswordInput.value.trim();

            if (!email || !password) {
                loginErrorMessage.textContent = "Kripya email aur password dono enter karein.";
                loginErrorMessage.classList.remove('hidden');
                loginSubmitButton.disabled = false;
                loginButtonText.textContent = 'Login';
                loginLoadingSpinner.classList.add('hidden');
                return;
            }

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                console.log("User login ho gaya:", user.uid);

                if (!user.emailVerified) {
                    showCustomModal('Email Verified Nahi', 'Aapka email verified nahi hai. Kripya apne inbox mein verification link check karein. Ya link ko dobara bhejne ke liye Ok par click karein.', true, async () => {
                        await sendEmailVerification(user);
                        showCustomModal('Email Bhej Diya', 'Verification email dobara bhej diya gaya!', false);
                    });
                    await signOut(auth); // Agar email verified nahi hai toh sign out karein
                } else {
                    // Safalta, onAuthStateChanged UI update ko handle karega
                    console.log("User login ho gaya aur email verified hai.");
                    loginForm.reset();
                    closeModal('auth');
                }
            } catch (error) {
                console.error("Login error:", error);
                let errorMessage = "Login karne mein asafal.";
                if (error.code === 'auth/user-not-found' || error.code === 'auth/wrong-password') {
                    errorMessage = "Invalid email ya password.";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "Invalid email address.";
                }
                loginErrorMessage.textContent = errorMessage;
                loginErrorMessage.classList.remove('hidden');
            } finally {
                loginSubmitButton.disabled = false;
                loginButtonText.textContent = 'Login';
                loginLoadingSpinner.classList.add('hidden');
            }
        }

        /**
         * Google Sign-in ko handle karta hai.
         */
        async function handleGoogleSignIn() {
            googleSignInButton.disabled = true;
            guestLoginButton.disabled = true; // Sign-in ke dauraan dusre buttons ko disable karein
            loginSubmitButton.disabled = true;
            signupSubmitButton.disabled = true;

            try {
                const provider = new GoogleAuthProvider();
                const result = await signInWithPopup(auth, provider);
                const user = result.user;
                console.log("Google se sign in kiya gaya user:", user.uid);
                // onAuthStateChanged UI update aur profile creation ko handle karega
                closeModal('auth');
            } catch (error) {
                console.error("Google Sign-in error:", error);
                if (error.code === 'auth/popup-closed-by-user') {
                    console.log("Google Sign-in popup user dwara band kiya gaya.");
                } else {
                    showCustomModal('Google Sign-in Error', `Google se sign in karne mein asafal: ${error.message}`, false);
                }
            } finally {
                googleSignInButton.disabled = false;
                guestLoginButton.disabled = false;
                loginSubmitButton.disabled = false;
                signupSubmitButton.disabled = false;
            }
        }

        /**
         * Password Bhool Gaye flow ko handle karta hai.
         */
        async function handleForgotPassword() {
            const email = loginEmailInput.value.trim();
            if (!email) {
                loginErrorMessage.textContent = "Password reset karne ke liye apna email enter karein.";
                loginErrorMessage.classList.remove('hidden');
                return;
            }
            try {
                await sendPasswordResetEmail(auth, email);
                showCustomModal('Password Reset', `${email} par password reset email bhej diya gaya hai. Apna inbox check karein.`, false);
                loginErrorMessage.classList.add('hidden');
            } catch (error) {
                console.error("Password bhool gaye error:", error);
                let errorMessage = "Password reset email bhejne mein asafal.";
                if (error.code === 'auth/user-not-found') {
                    errorMessage = "Is email se koi user nahi mila.";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "Invalid email address.";
                }
                loginErrorMessage.textContent = errorMessage;
                loginErrorMessage.classList.remove('hidden');
            }
        }

        /**
         * "Guest ke roop mein jaari rakhein" (anonymous login) ko handle karta hai.
         */
        async function handleGuestLogin() {
            guestLoginButton.disabled = true;
            guestLoginButtonText.textContent = 'Login ho raha hai...';
            guestLoginLoadingSpinner.classList.remove('hidden');
            googleSignInButton.disabled = true;
            loginSubmitButton.disabled = true;
            signupSubmitButton.disabled = true;

            try {
                await signInAnonymously(auth);
                // onAuthStateChanged UI update aur profile creation ko handle karega
                closeModal('auth');
            } catch (error) {
                console.error("Guest login error:", error);
                showCustomModal('Guest Login Error', `Guest ke roop mein sign in karne mein asafal: ${error.message}. Kripya dobara prayas karein.`, false);
            } finally {
                guestLoginButton.disabled = false;
                guestLoginButtonText.textContent = 'Guest ke roop mein jaari rakhein';
                guestLoginLoadingSpinner.classList.add('hidden');
                googleSignInButton.disabled = false;
                loginSubmitButton.disabled = false;
                signupSubmitButton.disabled = false;
            }
        }


        // --- Ad Script Injection (Global) ---
        // Third-party ads ke liye dynamically script elements banayein aur append karein.

        function loadScript(src, type = 'text/javascript', parent = document.body) {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = src;
                script.type = type;
                script.async = true;
                script.referrerPolicy = 'no-referrer-when-downgrade'; // Kuch ad networks ke liye

                script.onload = () => {
                    console.log(`Script load ho gaya: ${src}`);
                    resolve(script);
                };
                script.onerror = (e) => {
                    console.error(`Script load karne mein error: ${src}`, e);
                    reject(new Error(`Script load karne mein asafal ${src}`));
                };
                parent.appendChild(script);
            });
        }

        function injectExternalAdScripts() {
            console.log("External ad scripts inject kar rahe hain...");

            // Adstreaa Social Bar
            loadScript('//pl26835180.profitableratecpm.com/51/87/c3/5187c39d0d72d45de29e9c62b51aaba2.js');

            // Adstreaa Native Ads
            // Iske invoke hone ke liye div ki zaroorat hai
            const nativeAdDiv = document.createElement('div');
            nativeAdDiv.id = "container-39628927897b21d6c45567203000ccc6";
            nativeAdDiv.className = "my-4 p-4 bg-gray-900 rounded-lg text-center text-gray-400"; // Styling for visibility
            nativeAdDiv.textContent = "Native Ad (Placeholder)"; // Placeholder text
            document.body.appendChild(nativeAdDiv);
            loadScript('//pl26835150.profitableratecpm.com/39628927897b21d6c45567203000ccc6/invoke.js', 'text/javascript', document.head)
                .then(() => {
                    console.log("Adstreaa Native Ads script load ho gaya aur div taiyar hai.");
                });

            // Hilltops Popunder (bahut invasive, isse hattana behtar hai ya bahut kam use karna)
            // Agar aap ise zaroor rakhna chahte hain, toh yahaan uncomment karein.
            // Main ise abhi comment hi rakunga user experience ke liye.
            // const hilltopsPopunderTrigger = `
            //     if (!window._hilltopsPopunderLoaded) {
            //         setTimeout(function() {
            //             window.open('https://assured-sandwich.com/bV3fV.0WPv3/pSvrb/m/VsJQZ/DR0/2XN/D/In0JNVTzMU3MLVThYo0-MvjeQB1/Mgz/gT', '_blank');
            //             window._hilltopsPopunderLoaded = true;
            //         }, 15000); // 15 seconds ke baad popunder trigger karein
            //     }
            // `;
            // const hilltopsPopunderScript = document.createElement('script');
            // hilltopsPopunderScript.textContent = hilltopsPopunderTrigger;
            // document.body.appendChild(hilltopsPopunderScript);
            // console.log("Hilltops Popunder script trigger inject kiya gaya.");

            // Adstreaa Popunder Ad (bhi invasive)
            // loadScript('//pl26835142.profitableratecpm.com/db/27/6d/db276d3b5f1289379bbe5d365485ac52.js');


            // Hilltops Banner 300x100 (yeh bhi global, agar aap isse global footer mein rakhna chahte hain toh)
            // Maine isse abhi comment rakha hai, kyunki video cards mein specific banners hain.
            /*
            const hilltopsBanner300x100Fn = `
                (function(ahzkl){
                var d = document,
                s = d.createElement('script'),
                l = d.scripts[d.scripts.length - 1];
                s.settings = ahzkl || {};
                s.src = "//definitive-priority.com/brX/VEs/d.GRlA0BY_Wicn/behmh9xu/ZeUrlXkDPKTFY/0wMxjKQC1KNtTGM_tpNpjwQGyMN/DdUR1HNjAm";
                s.async = true;
                s.referrerPolicy = 'no-referrer-when-downgrade';
                l.parentNode.insertBefore(s, l);
                })({});
            `;
            const hilltopsBannerScript = document.createElement('script');
            hilltopsBannerScript.textContent = hilltopsBanner300x100Fn;
            document.body.appendChild(hilltopsBannerScript);
            */

            console.log("Sabhi external ad scripts inject karne ke liye shuru kiye gaye.");
        }


        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            console.log("DOM Content Load ho gaya. App initialization shuru kar rahe hain.");
            // Jab DOM taiyar ho jaye tab Firebase ko initialize karein
            initializeFirebase();

            // Global ad scripts inject karein
            injectExternalAdScripts();

            // Header Button Listeners
            document.getElementById('search-button').addEventListener('click', () => showPage('search'));
            document.getElementById('profile-header-button').addEventListener('click', () => showPage('profile'));
            document.getElementById('upload-header-button').addEventListener('click', openUploadModal);
            document.getElementById('withdraw-header-button').addEventListener('click', openWithdrawModal);
            signOutButton.addEventListener('click', handleSignOut);

            // Footer Button Listeners
            document.getElementById('home-footer-button').addEventListener('click', () => showPage('home'));
            document.getElementById('people-footer-button').addEventListener('click', () => showPage('people'));
            document.getElementById('upload-footer-button').addEventListener('click', openUploadModal);
            document.getElementById('profile-footer-button').addEventListener('click', () => showPage('profile'));

            // Custom Modal Listeners (modal dikhane/chhupane par delegate kiye gaye)
            customModalCloseButton.addEventListener('click', () => closeModal('custom'));
            // Confirm button ka listener showCustomModal mein dynamically set kiya jata hai

            // Comment Modal Listeners
            commentModalCloseButton.addEventListener('click', () => closeModal('comment'));
            addCommentButton.addEventListener('click', addComment);
            newCommentInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    addComment();
                }
            });

            // Upload Modal Listeners
            uploadModalCloseButton.addEventListener('click', () => closeModal('upload'));
            uploadVideoForm.addEventListener('submit', handleUploadSubmit);

            // Withdraw Modal Listeners
            withdrawModalCloseButton.addEventListener('click', () => closeModal('withdraw'));
            withdrawForm.addEventListener('submit', handleWithdrawSubmit);

            // Authentication Modal Listeners
            authTabLogin.addEventListener('click', () => switchAuthTab('login'));
            authTabSignup.addEventListener('click', () => switchAuthTab('signup'));
            loginForm.addEventListener('submit', handleEmailLogin);
            signupForm.addEventListener('submit', handleEmailSignup);
            googleSignInButton.addEventListener('click', handleGoogleSignIn);
            guestLoginButton.addEventListener('click', handleGuestLogin);
            forgotPasswordButton.addEventListener('click', handleForgotPassword);
        });

        // Window resize hone par IMA ad container size update karein,
        // halanki global container CSS ke saath achhe se handle karega.
        window.addEventListener('resize', () => {
            if (currentAdManager && imaAdContainer.style.display !== 'none') {
                 // Zaroori: Agar container dimensions badalte hain jab ad active hai toh ad manager ko re-init ya resize karein
                currentAdManager.resize(imaAdContainer.offsetWidth, imaAdContainer.offsetHeight, google.ima.ViewMode.NORMAL);
            }
        });

    </script>
</body>
</html>
